<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数据分析 - 小米AIoT边缘安全控制面板</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
    <style>
        :root {
            --primary: #ff6700;
            --secondary: #2c2c2c;
            --light-gray: #f5f5f5;
            --border-color: #e0e0e0;
            --success: #52c41a;
            --warning: #faad14;
            --danger: #f5222d;
            --text: #333333;
            --text-light: #666666;
            --info: #1890ff;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #fafafa;
            color: var(--text);
        }
        
        .layout {
            display: flex;
            min-height: 100vh;
        }
        
        .sidebar {
            width: 250px;
            background-color: var(--secondary);
            color: white;
            padding: 20px 0;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
        }
        
        .logo {
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
        }
        
        .logo i {
            margin-right: 10px;
        }
        
        .logo h2 {
            font-size: 16px;
            font-weight: 500;
        }
        
        .menu {
            margin-top: 20px;
        }
        
        .menu-item {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.2s;
            color: rgba(255,255,255,0.7);
            text-decoration: none;
        }
        
        .menu-item.active {
            background-color: rgba(255,255,255,0.1);
            color: white;
            border-left: 3px solid var(--primary);
        }
        
        .menu-item:hover {
            background-color: rgba(255,255,255,0.05);
            color: white;
        }
        
        .menu-item i {
            margin-right: 10px;
            font-size: 18px;
            width: 24px;
            text-align: center;
        }
        
        .content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .page-title {
            font-size: 24px;
            font-weight: 500;
        }

        .date-range {
            display: flex;
            align-items: center;
        }

        .date-range input {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            width: 220px;
            font-size: 14px;
        }
        
        .card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .card-header {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .card-title {
            font-size: 16px;
            font-weight: 500;
        }
        
        .card-body {
            padding: 16px;
        }
        
        .analytics-summary {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 20px;
        }
        
        .summary-card {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .summary-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .summary-label {
            font-size: 14px;
            color: var(--text-light);
            margin-bottom: 8px;
        }
        
        .summary-value {
            font-size: 24px;
            font-weight: 500;
            color: var(--text);
        }
        
        .summary-trend {
            display: flex;
            align-items: center;
            font-size: 12px;
            margin-top: 8px;
        }
        
        .trend-up {
            color: var(--success);
        }
        
        .trend-down {
            color: var(--danger);
        }

        .chart-container {
            height: 300px;
            margin-bottom: 20px;
        }

        .charts-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        .device-activity-wrapper {
            border-radius: 8px;
            padding: 16px;
            background-color: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .device-activity-chart {
            height: 300px;
        }

        .map-container {
            height: 400px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            padding: 16px;
        }

        .device-map {
            height: 100%;
            background-color: #f0f0f0;
            border-radius: 4px;
        }

        .btn {
            padding: 6px 12px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
        }
        
        .btn i, .btn .material-icons {
            margin-right: 6px;
            font-size: 16px;
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #ff8533;
        }
        
        .btn-default {
            background-color: var(--light-gray);
            color: var(--text);
        }
        
        .btn-default:hover {
            background-color: #e5e5e5;
        }

        .btn-info {
            background-color: var(--info);
            color: white;
        }

        .btn-info:hover {
            background-color: #40a9ff;
        }

        .filter-row {
            display: flex;
            gap: 16px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .filter-group {
            display: flex;
            align-items: center;
        }
        
        .filter-label {
            font-size: 14px;
            margin-right: 8px;
        }
        
        .filter-select {
            padding: 6px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            min-width: 120px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .data-table th, .data-table td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        
        .data-table th {
            background-color: var(--light-gray);
            font-weight: 500;
        }
        
        .data-table tbody tr:hover {
            background-color: #f9f9f9;
        }

        .status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            display: inline-block;
        }
        
        .status-normal {
            background-color: rgba(82, 196, 26, 0.1);
            color: var(--success);
        }
        
        .status-alert {
            background-color: rgba(245, 34, 45, 0.1);
            color: var(--danger);
        }
        
        .status-warning {
            background-color: rgba(250, 173, 20, 0.1);
            color: var(--warning);
        }

        .status-info {
            background-color: rgba(24, 144, 255, 0.1);
            color: var(--info);
        }

        .tabs {
            display: flex;
            margin-bottom: 16px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .tab {
            padding: 12px 20px;
            cursor: pointer;
            position: relative;
        }
        
        .tab.active {
            color: var(--primary);
            font-weight: 500;
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 2px;
            background-color: var(--primary);
        }

        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }

        .alert-severity {
            position: relative;
            padding-left: 20px;
        }

        .alert-severity::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .severity-high::before {
            background-color: var(--danger);
        }

        .severity-medium::before {
            background-color: var(--warning);
        }

        .severity-low::before {
            background-color: var(--success);
        }

        .pagination {
            display: flex;
            justify-content: flex-end;
            margin-top: 16px;
            gap: 8px;
        }
        
        .page-btn {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .page-btn.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .page-btn:hover:not(.active) {
            background-color: var(--light-gray);
        }

        .export-options {
            position: absolute;
            right: 16px;
            top: 50px;
            background-color: white;
            border-radius: 4px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.15);
            display: none;
            z-index: 100;
        }
        
        .export-option {
            padding: 10px 16px;
            cursor: pointer;
            white-space: nowrap;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
        }
        
        .export-option:hover {
            background-color: var(--light-gray);
        }
        
        .export-option i {
            margin-right: 8px;
            font-size: 16px;
        }

        /* 模态框样式 */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 20px;
            border-radius: 8px;
            width: 60%;
            max-width: 800px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.2);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: 500;
        }
        
        .close-modal {
            font-size: 24px;
            cursor: pointer;
            color: var(--text-light);
        }

        .close-modal:hover {
            color: var(--text);
        }
        
        .modal-body {
            margin-bottom: 16px;
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
        }

        /* Material Icons */
        @font-face {
            font-family: 'Material Icons';
            font-style: normal;
            font-weight: 400;
            src: url(https://cdnjs.cloudflare.com/ajax/libs/material-design-icons/3.0.1/iconfont/MaterialIcons-Regular.woff2) format('woff2');
        }

        .material-icons {
            font-family: 'Material Icons';
            font-weight: normal;
            font-style: normal;
            font-size: 24px;
            line-height: 1;
            letter-spacing: normal;
            text-transform: none;
            display: inline-block;
            white-space: nowrap;
            word-wrap: normal;
            direction: ltr;
            -webkit-font-feature-settings: 'liga';
            -webkit-font-smoothing: antialiased;
        }
    </style>
</head>
<body>
    <div class="layout">
        <div class="sidebar">
            <div class="logo">
                <i class="material-icons">security</i>
                <h2>小米AIoT边缘安全</h2>
            </div>
            <div class="menu">
                <a href="/" class="menu-item">
                    <i class="material-icons">dashboard</i>
                    <span>首页</span>
                </a>
                <a href="/devices" class="menu-item">
                    <i class="material-icons">devices</i>
                    <span>设备管理</span>
                </a>
                <a href="/security" class="menu-item">
                    <i class="material-icons">shield</i>
                    <span>安全监控</span>
                </a>
                <a href="/analytics" class="menu-item active">
                    <i class="material-icons">bar_chart</i>
                    <span>数据分析</span>
                </a>
                <a href="/settings" class="menu-item">
                    <i class="material-icons">settings</i>
                    <span>系统设置</span>
                </a>
            </div>
        </div>
        
        <div class="content">
            <div class="header">
                <h1 class="page-title">数据分析</h1>
                <div class="date-range">
                    <input type="text" id="reportrange" value="最近7天" />
                </div>
            </div>
            
            <!-- 数据概览 -->
            <div class="analytics-summary">
                <div class="summary-card" onclick="showDetailModal('总设备健康指数')">
                    <div class="summary-label">总设备健康指数</div>
                    <div class="summary-value">92%</div>
                    <div class="summary-trend trend-up">
                        <i class="material-icons">arrow_upward</i>
                        <span>较上周 +2%</span>
                    </div>
                </div>
                <div class="summary-card" onclick="showDetailModal('总设备异常率')">
                    <div class="summary-label">设备异常率</div>
                    <div class="summary-value">3.2%</div>
                    <div class="summary-trend trend-down">
                        <i class="material-icons">arrow_downward</i>
                        <span>较上周 -1.5%</span>
                    </div>
                </div>
                <div class="summary-card" onclick="showDetailModal('安全事件总数')">
                    <div class="summary-label">安全事件总数</div>
                    <div class="summary-value">14</div>
                    <div class="summary-trend trend-down">
                        <i class="material-icons">arrow_downward</i>
                        <span>较上周 -8</span>
                    </div>
                </div>
                <div class="summary-card" onclick="showDetailModal('平均响应时间')">
                    <div class="summary-label">平均响应时间</div>
                    <div class="summary-value">218ms</div>
                    <div class="summary-trend trend-up">
                        <i class="material-icons">arrow_upward</i>
                        <span>较上周 +12ms</span>
                    </div>
                </div>
            </div>
            
            <!-- 主要图表区域 -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">整体性能分析</h2>
                    <div style="position: relative;">
                        <button class="btn btn-default" id="exportButton">
                            <i class="material-icons">download</i>
                            导出数据
                        </button>
                        <div class="export-options" id="exportOptions">
                            <div class="export-option" onclick="exportData('pdf')">
                                <i class="material-icons">picture_as_pdf</i>
                                导出为PDF
                            </div>
                            <div class="export-option" onclick="exportData('csv')">
                                <i class="material-icons">table_chart</i>
                                导出为CSV
                            </div>
                            <div class="export-option" onclick="exportData('image')">
                                <i class="material-icons">image</i>
                                导出为图片
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card-body">
                    <!-- 图表切换选项卡 -->
                    <div class="tabs">
                        <div class="tab active" data-tab="performance">性能趋势</div>
                        <div class="tab" data-tab="security">安全趋势</div>
                        <div class="tab" data-tab="bandwidth">带宽使用</div>
                        <div class="tab" data-tab="reliability">可靠性分析</div>
                    </div>
                    
                    <!-- 性能趋势内容 -->
                    <div class="tab-content active" id="performance-tab">
                        <div class="filter-row">
                            <div class="filter-group">
                                <span class="filter-label">指标：</span>
                                <select class="filter-select" id="performanceMetric">
                                    <option value="cpu">CPU使用率</option>
                                    <option value="memory">内存使用率</option>
                                    <option value="latency">延迟</option>
                                    <option value="all" selected>全部指标</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <span class="filter-label">设备类型：</span>
                                <select class="filter-select" id="deviceTypePerformance">
                                    <option value="all" selected>全部</option>
                                    <option value="camera">摄像头</option>
                                    <option value="sensor">传感器</option>
                                    <option value="gateway">网关</option>
                                    <option value="controller">控制器</option>
                                </select>
                            </div>
                            <button class="btn btn-primary" id="refreshPerformance">
                                <i class="material-icons">refresh</i>
                                刷新数据
                            </button>
                        </div>
                        <div class="chart-container">
                            <canvas id="performanceChart"></canvas>
                        </div>
                        <div>
                            <h3 style="margin: 20px 0 16px;">性能详情表</h3>
                            <table class="data-table" id="performanceTable">
                                <thead>
                                    <tr>
                                        <th>设备名称</th>
                                        <th>CPU使用率(%)</th>
                                        <th>内存使用率(%)</th>
                                        <th>延迟(ms)</th>
                                        <th>状态</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>主网关</td>
                                        <td>32.5</td>
                                        <td>45.2</td>
                                        <td>18</td>
                                        <td><span class="status status-normal">正常</span></td>
                                        <td><button class="btn btn-default">详情</button></td>
                                    </tr>
                                    <tr>
                                        <td>前门摄像头</td>
                                        <td>62.1</td>
                                        <td>58.3</td>
                                        <td>42</td>
                                        <td><span class="status status-warning">注意</span></td>
                                        <td><button class="btn btn-default">详情</button></td>
                                    </tr>
                                    <tr>
                                        <td>客厅传感器</td>
                                        <td>15.3</td>
                                        <td>22.7</td>
                                        <td>12</td>
                                        <td><span class="status status-normal">正常</span></td>
                                        <td><button class="btn btn-default">详情</button></td>
                                    </tr>
                                    <tr>
                                        <td>电源管理单元</td>
                                        <td>28.9</td>
                                        <td>35.6</td>
                                        <td>24</td>
                                        <td><span class="status status-normal">正常</span></td>
                                        <td><button class="btn btn-default">详情</button></td>
                                    </tr>
                                    <tr>
                                        <td>后院摄像头</td>
                                        <td>78.2</td>
                                        <td>73.4</td>
                                        <td>67</td>
                                        <td><span class="status status-alert">异常</span></td>
                                        <td><button class="btn btn-default">详情</button></td>
                                    </tr>
                                </tbody>
                            </table>
                            <div class="pagination">
                                <div class="page-btn">
                                    <i class="material-icons" style="font-size: 16px;">chevron_left</i>
                                </div>
                                <div class="page-btn active">1</div>
                                <div class="page-btn">2</div>
                                <div class="page-btn">
                                    <i class="material-icons" style="font-size: 16px;">chevron_right</i>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 安全趋势内容 -->
                    <div class="tab-content" id="security-tab">
                        <div class="filter-row">
                            <div class="filter-group">
                                <span class="filter-label">风险级别：</span>
                                <select class="filter-select" id="securityLevel">
                                    <option value="all" selected>全部</option>
                                    <option value="high">高</option>
                                    <option value="medium">中</option>
                                    <option value="low">低</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <span class="filter-label">事件类型：</span>
                                <select class="filter-select" id="eventType">
                                    <option value="all" selected>全部</option>
                                    <option value="unauthorized">未授权访问</option>
                                    <option value="malware">恶意软件</option>
                                    <option value="dos">拒绝服务</option>
                                    <option value="brute">暴力破解</option>
                                </select>
                            </div>
                            <button class="btn btn-primary" id="refreshSecurity">
                                <i class="material-icons">refresh</i>
                                刷新数据
                            </button>
                        </div>
                        <div class="chart-container">
                            <canvas id="securityChart"></canvas>
                        </div>
                        <div>
                            <h3 style="margin: 20px 0 16px;">安全事件</h3>
                            <table class="data-table" id="securityTable">
                                <thead>
                                    <tr>
                                        <th>时间</th>
                                        <th>设备</th>
                                        <th>事件类型</th>
                                        <th>风险级别</th>
                                        <th>状态</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>2025-04-14 08:23</td>
                                        <td>主网关</td>
                                        <td>未授权访问尝试</td>
                                        <td><span class="alert-severity severity-high">高</span></td>
                                        <td><span class="status status-alert">未解决</span></td>
                                        <td><button class="btn btn-default">处理</button></td>
                                    </tr>
                                    <tr>
                                        <td>2025-04-14 05:47</td>
                                        <td>前门摄像头</td>
                                        <td>异常数据传输</td>
                                        <td><span class="alert-severity severity-medium">中</span></td>
                                        <td><span class="status status-info">已修复</span></td>
                                        <td><button class="btn btn-default">详情</button></td>
                                    </tr>
                                    <tr>
                                        <td>2025-04-13 22:15</td>
                                        <td>电源管理单元</td>
                                        <td>固件漏洞</td>
                                        <td><span class="alert-severity severity-high">高</span></td>
                                        <td><span class="status status-info">已修复</span></td>
                                        <td><button class="btn btn-default">详情</button></td>
                                    </tr>
                                    <tr>
                                        <td>2025-04-13 16:32</td>
                                        <td>后院摄像头</td>
                                        <td>弱密码</td>
                                        <td><span class="alert-severity severity-medium">中</span></td>
                                        <td><span class="status status-warning">处理中</span></td>
                                        <td><button class="btn btn-default">处理</button></td>
                                    </tr>
                                    <tr>
                                        <td>2025-04-13 10:08</td>
                                        <td>客厅传感器</td>
                                        <td>异常通信</td>
                                        <td><span class="alert-severity severity-low">低</span></td>
                                        <td><span class="status status-info">已修复</span></td>
                                        <td><button class="btn btn-default">详情</button></td>
                                    </tr>
                                </tbody>
                            </table>
                            <div class="pagination">
                                <div class="page-btn">
                                    <i class="material-icons" style="font-size: 16px;">chevron_left</i>
                                </div>
                                <div class="page-btn active">1</div>
                                <div class="page-btn">2</div>
                                <div class="page-btn">3</div>
                                <div class="page-btn">
                                    <i class="material-icons" style="font-size: 16px;">chevron_right</i>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 带宽使用内容 -->
                    <div class="tab-content" id="bandwidth-tab">
                        <div class="filter-row">
                            <div class="filter-group">
                                <span class="filter-label">设备：</span>
                                <select class="filter-select" id="bandwidthDevice">
                                    <option value="all" selected>全部设备</option>
                                    <option value="camera">摄像头</option>
                                    <option value="gateway">网关</option>
                                    <option value="sensor">传感器</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <span class="filter-label">数据视图：</span>
                                <select class="filter-select" id="bandwidthView">
                                    <option value="realtime" selected>实时数据</option>
                                    <option value="hourly">小时数据</option>
                                    <option value="daily">每日数据</option>
                                    <option value="weekly">每周数据</option>
                                </select>
                            </div>
                            <button class="btn btn-primary" id="refreshBandwidth">
                                <i class="material-icons">refresh</i>
                                刷新数据
                            </button>
                        </div>
                        <div class="chart-container">
                            <canvas id="bandwidthChart"></canvas>
                        </div>
                        <div>
                            <h3 style="margin: 20px 0 16px;">带宽使用情况</h3>
                            <table class="data-table" id="bandwidthTable">
                                <thead>
                                    <tr>
                                        <th>设备</th>
                                        <th>上传带宽(Mbps)</th>
                                        <th>下载带宽(Mbps)</th>
                                        <th>总流量(GB)</th>
                                        <th>异常检测</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>主网关</td>
                                        <td>54.2</td>
                                        <td>78.5</td>
                                        <td>36.7</td>
                                        <td><span class="status status-normal">正常</span></td>
                                        <td><button class="btn btn-default">详情</button></td>
                                    </tr>
                                    <tr>
                                        <td>前门摄像头</td>
                                        <td>12.3</td>
                                        <td>2.1</td>
                                        <td>8.4</td>
                                        <td><span class="status status-normal">正常</span></td>
                                        <td><button class="btn btn-default">详情</button></td>
                                    </tr>
                                    <tr>
                                        <td>后院摄像头</td>
                                        <td>18.7</td>
                                        <td>1.9</td>
                                        <td>15.2</td>
                                        <td><span class="status status-warning">异常峰值</span></td>
                                        <td><button class="btn btn-default">详情</button></td>
                                    </tr>
                                    <tr>
                                        <td>客厅传感器</td>
                                        <td>0.8</td>
                                        <td>0.2</td>
                                        <td>0.4</td>
                                        <td><span class="status status-normal">正常</span></td>
                                        <td><button class="btn btn-default">详情</button></td>
                                    </tr>
                                    <tr>
                                        <td>电源管理单元</td>
                                        <td>1.2</td>
                                        <td>0.5</td>
                                        <td>0.6</td>
                                        <td><span class="status status-normal">正常</span></td>
                                        <td><button class="btn btn-default">详情</button></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- 可靠性分析内容 -->
                    <div class="tab-content" id="reliability-tab">
                        <div class="filter-row">
                            <div class="filter-group">
                                <span class="filter-label">指标：</span>
                                <select class="filter-select" id="reliabilityMetric">
                                    <option value="uptime" selected>在线时间</option>
                                    <option value="errors">错误率</option>
                                    <option value="mtbf">平均故障间隔时间</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <span class="filter-label">设备组：</span>
                                <select class="filter-select" id="reliabilityGroup">
                                    <option value="all" selected>全部</option>
                                    <option value="critical">关键设备</option>
                                    <option value="peripheral">外围设备</option>
                                </select>
                            </div>
                            <button class="btn btn-primary" id="refreshReliability">
                                <i class="material-icons">refresh</i>
                                刷新数据
                            </button>
                        </div>
                        <div class="chart-container">
                            <canvas id="reliabilityChart"></canvas>
                        </div>
                        <div>
                            <h3 style="margin: 20px 0 16px;">设备可靠性指标</h3>
                            <table class="data-table" id="reliabilityTable">
                                <thead>
                                    <tr>
                                        <th>设备</th>
                                        <th>正常运行时间(%)</th>
                                        <th>平均故障间隔(天)</th>
                                        <th>故障次数(30天)</th>
                                        <th>可靠性评分</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>主网关</td>
                                        <td>99.98</td>
                                        <td>45.2</td>
                                        <td>1</td>
                                        <td><span class="status status-normal">优秀</span></td>
                                        <td><button class="btn btn-default">详情</button></td>
                                    </tr>
                                    <tr>
                                        <td>前门摄像头</td>
                                        <td>98.76</td>
                                        <td>28.3</td>
                                        <td>3</td>
                                        <td><span class="status status-normal">良好</span></td>
                                        <td><button class="btn btn-default">详情</button></td>
                                    </tr>
                                    <tr>
                                        <td>客厅传感器</td>
                                        <td>99.92</td>
                                        <td>38.5</td>
                                        <td>2</td>
                                        <td><span class="status status-normal">优秀</span></td>
                                        <td><button class="btn btn-default">详情</button></td>
                                    </tr>
                                    <tr>
                                        <td>电源管理单元</td>
                                        <td>99.85</td>
                                        <td>42.1</td>
                                        <td>1</td>
                                        <td><span class="status status-normal">优秀</span></td>
                                        <td><button class="btn btn-default">详情</button></td>
                                    </tr>
                                    <tr>
                                        <td>后院摄像头</td>
                                        <td>92.45</td>
                                        <td>12.7</td>
                                        <td>8</td>
                                        <td><span class="status status-warning">需改进</span></td>
                                        <td><button class="btn btn-default">详情</button></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 设备活动和分布 -->
            <div class="charts-row">
                <!-- 设备活动图表 -->
                <div class="device-activity-wrapper">
                    <h2 class="card-title" style="margin-bottom: 16px;">设备活动热力图</h2>
                    <div class="filter-row">
                        <div class="filter-group">
                            <span class="filter-label">设备:</span>
                            <select class="filter-select" id="activityDevice">
                                <option value="all" selected>全部设备</option>
                                <option value="cameras">摄像头</option>
                                <option value="sensors">传感器</option>
                                <option value="controllers">控制器</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <span class="filter-label">活动类型:</span>
                            <select class="filter-select" id="activityType">
                                <option value="all" selected>全部活动</option>
                                <option value="data">数据传输</option>
                                <option value="alerts">警报</option>
                                <option value="commands">命令</option>
                            </select>
                        </div>
                    </div>
                    <div class="device-activity-chart" id="activityHeatmap"></div>
                </div>
                
                <!-- 设备类型分布图表 -->
                <div class="device-activity-wrapper">
                    <h2 class="card-title" style="margin-bottom: 16px;">设备类型分布</h2>
                    <div class="filter-row">
                        <div class="filter-group">
                            <span class="filter-label">视图:</span>
                            <select class="filter-select" id="distributionView">
                                <option value="type" selected>按类型</option>
                                <option value="location">按位置</option>
                                <option value="status">按状态</option>
                            </select>
                        </div>
                        <button class="btn btn-default" id="distributionExport">
                            <i class="material-icons">save_alt</i>
                            保存
                        </button>
                    </div>
                    <div class="device-activity-chart" id="deviceDistribution"></div>
                </div>
            </div>
            
            <!-- 设备地理分布地图 -->
            <div class="map-container">
                <h2 class="card-title" style="margin-bottom: 16px;">设备部署地图</h2>
                <div class="filter-row">
                    <div class="filter-group">
                        <span class="filter-label">显示:</span>
                        <select class="filter-select" id="mapShowOptions">
                            <option value="all" selected>全部设备</option>
                            <option value="online">在线设备</option>
                            <option value="offline">离线设备</option>
                            <option value="alerts">有警报设备</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <span class="filter-label">楼层:</span>
                        <select class="filter-select" id="mapFloor">
                            <option value="all" selected>全部楼层</option>
                            <option value="1f">一层</option>
                            <option value="2f">二层</option>
                            <option value="outside">室外</option>
                        </select>
                    </div>
                    <button class="btn btn-primary">
                        <i class="material-icons">add</i>
                        添加设备
                    </button>
                </div>
                <div class="device-map" id="deviceLocationMap"></div>
            </div>
            
            <!-- 异常检测结果 -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">智能异常检测</h2>
                    <button class="btn btn-info">
                        <i class="material-icons">assignment</i>
                        生成报告
                    </button>
                </div>
                <div class="card-body">
                    <div class="filter-row">
                        <div class="filter-group">
                            <span class="filter-label">检测算法:</span>
                            <select class="filter-select" id="anomalyAlgorithm">
                                <option value="all" selected>全部算法</option>
                                <option value="isolation">孤立森林</option>
                                <option value="gaussian">高斯混合模型</option>
                                <option value="autoencoder">自编码器</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <span class="filter-label">置信度阈值:</span>
                            <select class="filter-select" id="confidenceThreshold">
                                <option value="0.9" selected>90%</option>
                                <option value="0.8">80%</option>
                                <option value="0.7">70%</option>
                                <option value="0.6">60%</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" id="runAnomalyDetection">
                            <i class="material-icons">play_arrow</i>
                            运行检测
                        </button>
                    </div>
                    
                    <div class="charts-row">
                        <div class="chart-container" style="height: 300px;">
                            <canvas id="anomalyChart"></canvas>
                        </div>
                    </div>
                    
                    <h3 style="margin: 20px 0 16px;">检测结果</h3>
                    <table class="data-table" id="anomalyTable">
                        <thead>
                            <tr>
                                <th>设备</th>
                                <th>异常类型</th>
                                <th>时间</th>
                                <th>置信度</th>
                                <th>状态</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>后院摄像头</td>
                                <td>流量异常</td>
                                <td>2025-04-14 03:45</td>
                                <td>98%</td>
                                <td><span class="status status-alert">未解决</span></td>
                                <td>
                                    <button class="btn btn-default">查看</button>
                                    <button class="btn btn-primary">处理</button>
                                </td>
                            </tr>
                            <tr>
                                <td>主网关</td>
                                <td>连接模式异常</td>
                                <td>2025-04-13 22:12</td>
                                <td>92%</td>
                                <td><span class="status status-warning">处理中</span></td>
                                <td>
                                    <button class="btn btn-default">查看</button>
                                    <button class="btn btn-primary">处理</button>
                                </td>
                            </tr>
                            <tr>
                                <td>前门摄像头</td>
                                <td>CPU使用率异常</td>
                                <td>2025-04-13 15:23</td>
                                <td>87%</td>
                                <td><span class="status status-info">已解决</span></td>
                                <td>
                                    <button class="btn btn-default">查看</button>
                                    <button class="btn btn-default">记录</button>
                                </td>
                            </tr>
                            <tr>
                                <td>智能照明控制器</td>
                                <td>命令响应异常</td>
                                <td>2025-04-12 19:54</td>
                                <td>95%</td>
                                <td><span class="status status-info">已解决</span></td>
                                <td>
                                    <button class="btn btn-default">查看</button>
                                    <button class="btn btn-default">记录</button>
                                </td>
                            </tr>
                            <tr>
                                <td>电源管理单元</td>
                                <td>电压波动异常</td>
                                <td>2025-04-12 14:08</td>
                                <td>89%</td>
                                <td><span class="status status-info">已解决</span></td>
                                <td>
                                    <button class="btn btn-default">查看</button>
                                    <button class="btn btn-default">记录</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 详情模态框 -->
    <div class="modal" id="detailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">数据详情</h3>
                <span class="close-modal" onclick="closeModal()">&times;</span>
            </div>
            <div class="modal-body" id="modalBody">
                <div class="chart-container">
                    <canvas id="modalChart"></canvas>
                </div>
                <div id="modalDetails" style="margin-top: 20px;">
                    <!-- 详情内容动态生成 -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-default" onclick="closeModal()">关闭</button>
                <button class="btn btn-primary" onclick="exportModalData()">导出数据</button>
            </div>
        </div>
    </div>

    <script>
        // 日期范围选择器初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 模拟日期范围选择器
            const dateRangeInput = document.getElementById('reportrange');
            dateRangeInput.addEventListener('click', function() {
                alert('日期范围选择器将在这里打开');
            });
            
            // 导出按钮下拉菜单
            const exportButton = document.getElementById('exportButton');
            const exportOptions = document.getElementById('exportOptions');
            
            exportButton.addEventListener('click', function() {
                if (exportOptions.style.display === 'block') {
                    exportOptions.style.display = 'none';
                } else {
                    exportOptions.style.display = 'block';
                }
            });
            
            // 选项卡切换
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // 移除所有活动类
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    // 添加活动类到当前选项卡和内容
                    this.classList.add('active');
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                    
                    // 如果切换到这个标签，初始化/刷新图表
                    initializeCharts(tabId);
                });
            });
            
            // 初始化图表
            initializeCharts('performance');
            initializeDeviceActivityCharts();
        });
        
        // 初始化各种图表
        function initializeCharts(tabId) {
            if (tabId === 'performance') {
                initPerformanceChart();
            } else if (tabId === 'security') {
                initSecurityChart();
            } else if (tabId === 'bandwidth') {
                initBandwidthChart();
            } else if (tabId === 'reliability') {
                initReliabilityChart();
            }
        }
        
        // 性能图表初始化
        function initPerformanceChart() {
            const ctx = document.getElementById('performanceChart').getContext('2d');
            
            // 清除旧的图表实例
            if (window.performanceChartInstance) {
                window.performanceChartInstance.destroy();
            }
            
            // 模拟数据
            const labels = ['00:00', '03:00', '06:00', '09:00', '12:00', '15:00', '18:00', '21:00'];
            const cpuData = [25, 28, 32, 45, 60, 58, 42, 35];
            const memoryData = [40, 42, 45, 52, 55, 58, 50, 45];
            const latencyData = [15, 18, 20, 25, 32, 28, 22, 18];
            
            // 创建新图表
            window.performanceChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'CPU使用率 (%)',
                            data: cpuData,
                            borderColor: '#ff6700',
                            backgroundColor: 'rgba(255, 103, 0, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: '内存使用率 (%)',
                            data: memoryData,
                            borderColor: '#1890ff',
                            backgroundColor: 'rgba(24, 144, 255, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: '延迟 (ms)',
                            data: latencyData,
                            borderColor: '#52c41a',
                            backgroundColor: 'rgba(82, 196, 26, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        tooltip: {
                            enabled: true
                        },
                        legend: {
                            position: 'top'
                        }
                    }
                }
            });
            
            // 添加性能刷新按钮事件监听器
            document.getElementById('refreshPerformance').addEventListener('click', function() {
                // 模拟数据刷新
                const newCpuData = cpuData.map(val => val + Math.floor(Math.random() * 10) - 5);
                const newMemoryData = memoryData.map(val => val + Math.floor(Math.random() * 10) - 5);
                const newLatencyData = latencyData.map(val => val + Math.floor(Math.random() * 8) - 4);
                
                window.performanceChartInstance.data.datasets[0].data = newCpuData;
                window.performanceChartInstance.data.datasets[1].data = newMemoryData;
                window.performanceChartInstance.data.datasets[2].data = newLatencyData;
                window.performanceChartInstance.update();
                
                alert('性能数据已刷新');
            });
        }
        
        // 安全图表初始化
        function initSecurityChart() {
            const ctx = document.getElementById('securityChart').getContext('2d');
            
            // 清除旧的图表实例
            if (window.securityChartInstance) {
                window.securityChartInstance.destroy();
            }
            
            // 模拟数据
            const labels = ['4-8', '4-9', '4-10', '4-11', '4-12', '4-13', '4-14'];
            const highData = [2, 3, 1, 0, 4, 1, 2];
            const mediumData = [5, 4, 6, 3, 5, 4, 3];
            const lowData = [8, 7, 10, 6, 9, 7, 5];
            
            // 创建新图表
            window.securityChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: '高风险',
                            data: highData,
                            backgroundColor: 'rgba(245, 34, 45, 0.8)',
                            borderWidth: 0,
                            stack: 'security'
                        },
                        {
                            label: '中风险',
                            data: mediumData,
                            backgroundColor: 'rgba(250, 173, 20, 0.8)',
                            borderWidth: 0,
                            stack: 'security'
                        },
                        {
                            label: '低风险',
                            data: lowData,
                            backgroundColor: 'rgba(82, 196, 26, 0.8)',
                            borderWidth: 0,
                            stack: 'security'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            stacked: true
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        tooltip: {
                            mode: 'index'
                        }
                    }
                }
            });
            
            // 添加安全数据刷新按钮事件监听器
            document.getElementById('refreshSecurity').addEventListener('click', function() {
                // 模拟数据刷新
                const newHighData = highData.map(val => Math.max(0, val + Math.floor(Math.random() * 3) - 1));
                const newMediumData = mediumData.map(val => Math.max(0, val + Math.floor(Math.random() * 4) - 2));
                const newLowData = lowData.map(val => Math.max(0, val + Math.floor(Math.random() * 5) - 2));
                
                window.securityChartInstance.data.datasets[0].data = newHighData;
                window.securityChartInstance.data.datasets[1].data = newMediumData;
                window.securityChartInstance.data.datasets[2].data = newLowData;
                window.securityChartInstance.update();
                
                alert('安全数据已刷新');
            });
        }
        
        // 带宽图表初始化
        function initBandwidthChart() {
            const ctx = document.getElementById('bandwidthChart').getContext('2d');
            
            // 清除旧的图表实例
            if (window.bandwidthChartInstance) {
                window.bandwidthChartInstance.destroy();
            }
            
            // 模拟数据
            const labels = ['00:00', '03:00', '06:00', '09:00', '12:00', '15:00', '18:00', '21:00'];
            const uploadData = [25, 28, 20, 45, 80, 65, 42, 35];
            const downloadData = [40, 45, 35, 60, 95, 85, 55, 45];
            
            // 创建新图表
            window.bandwidthChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: '上传 (Mbps)',
                            data: uploadData,
                            borderColor: '#1890ff',
                            backgroundColor: 'rgba(24, 144, 255, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: '下载 (Mbps)',
                            data: downloadData,
                            borderColor: '#ff6700',
                            backgroundColor: 'rgba(255, 103, 0, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
            
            // 添加带宽数据刷新按钮事件监听器
            document.getElementById('refreshBandwidth').addEventListener('click', function() {
                // 模拟数据刷新
                const newUploadData = uploadData.map(val => val + Math.floor(Math.random() * 15) - 7);
                const newDownloadData = downloadData.map(val => val + Math.floor(Math.random() * 15) - 7);
                
                window.bandwidthChartInstance.data.datasets[0].data = newUploadData;
                window.bandwidthChartInstance.data.datasets[1].data = newDownloadData;
                window.bandwidthChartInstance.data.datasets[0].data = newUploadData;
                window.bandwidthChartInstance.data.datasets[1].data = newDownloadData;
                window.bandwidthChartInstance.update();
                
                alert('带宽数据已刷新');
            });
        }
        
        // 可靠性图表初始化
        function initReliabilityChart() {
            const ctx = document.getElementById('reliabilityChart').getContext('2d');
            
            // 清除旧的图表实例
            if (window.reliabilityChartInstance) {
                window.reliabilityChartInstance.destroy();
            }
            
            // 模拟数据 - 设备类型和正常运行时间百分比
            const devices = ['主网关', '前门摄像头', '后院摄像头', '客厅传感器', '电源管理单元', '智能照明控制器'];
            const uptimeData = [99.98, 98.76, 92.45, 99.92, 99.85, 94.32];
            
            // 为数据点创建颜色
            const backgroundColors = uptimeData.map(value => {
                if (value > 99.5) return 'rgba(82, 196, 26, 0.8)'; // 优秀 - 绿色
                if (value > 98) return 'rgba(82, 196, 26, 0.6)';  // 良好 - 浅绿色
                if (value > 95) return 'rgba(250, 173, 20, 0.8)'; // 中等 - 黄色
                return 'rgba(245, 34, 45, 0.8)'; // 差 - 红色
            });
            
            // 创建新图表
            window.reliabilityChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: devices,
                    datasets: [{
                        label: '正常运行时间 (%)',
                        data: uptimeData,
                        backgroundColor: backgroundColors,
                        borderWidth: 1,
                        borderColor: backgroundColors.map(color => color.replace('0.8', '1').replace('0.6', '1')),
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 90,
                            max: 100
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += context.parsed.y.toFixed(2) + '%';
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
            
            // 添加可靠性数据刷新按钮事件监听器
            document.getElementById('refreshReliability').addEventListener('click', function() {
                // 模拟数据刷新
                const newUptimeData = uptimeData.map(val => Math.min(100, Math.max(90, val + (Math.random() * 0.5 - 0.25))));
                
                // 更新颜色
                const newBackgroundColors = newUptimeData.map(value => {
                    if (value > 99.5) return 'rgba(82, 196, 26, 0.8)'; // 优秀 - 绿色
                    if (value > 98) return 'rgba(82, 196, 26, 0.6)';  // 良好 - 浅绿色
                    if (value > 95) return 'rgba(250, 173, 20, 0.8)'; // 中等 - 黄色
                    return 'rgba(245, 34, 45, 0.8)'; // 差 - 红色
                });
                
                window.reliabilityChartInstance.data.datasets[0].data = newUptimeData;
                window.reliabilityChartInstance.data.datasets[0].backgroundColor = newBackgroundColors;
                window.reliabilityChartInstance.data.datasets[0].borderColor = newBackgroundColors.map(color => color.replace('0.8', '1').replace('0.6', '1'));
                window.reliabilityChartInstance.update();
                
                alert('可靠性数据已刷新');
            });
        }
        
        // 设备活动和分布图表初始化
        function initializeDeviceActivityCharts() {
            initActivityHeatmap();
            initDeviceDistribution();
            initDeviceMap();
            initAnomalyChart();
        }
        
        // 设备活动热力图初始化
        function initActivityHeatmap() {
            // 初始化ECharts实例
            const activityChart = echarts.init(document.getElementById('activityHeatmap'));
            
            // 生成模拟数据
            const hours = ['00', '01', '02', '03', '04', '05', '06', '07', '08', '09', '10', '11', 
                       '12', '13', '14', '15', '16', '17', '18', '19', '20', '21', '22', '23'];
            const days = ['周一', '周二', '周三', '周四', '周五', '周六', '周日'];
            
            const data = [];
            for (let i = 0; i < 7; i++) {
                for (let j = 0; j < 24; j++) {
                    // 产生一些模拟数据
                    let value = Math.floor(Math.random() * 10);
                    if (j >= 8 && j <= 18 && i < 5) { // 工作日工作时间活动较多
                        value += Math.floor(Math.random() * 50);
                    }
                    data.push([j, i, value]);
                }
            }
            
            // 配置选项
            const option = {
                tooltip: {
                    position: 'top',
                    formatter: function (params) {
                        return `${days[params.value[1]]} ${hours[params.value[0]]}:00<br>活动量: ${params.value[2]}`;
                    }
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '10%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: hours,
                    splitArea: {
                        show: true
                    },
                    name: '小时',
                    nameLocation: 'middle',
                    nameGap: 30
                },
                yAxis: {
                    type: 'category',
                    data: days,
                    splitArea: {
                        show: true
                    },
                    name: '日期',
                    nameLocation: 'middle',
                    nameGap: 30
                },
                visualMap: {
                    min: 0,
                    max: 60,
                    calculable: true,
                    orient: 'horizontal',
                    left: 'center',
                    bottom: '0%',
                    inRange: {
                        color: ['#e0f7fa', '#4dd0e1', '#0097a7', '#006064']
                    }
                },
                series: [{
                    name: '设备活动量',
                    type: 'heatmap',
                    data: data,
                    emphasis: {
                        itemStyle: {
                            shadowBlur: 10,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }]
            };
            
            // 应用配置项
            activityChart.setOption(option);
            
            // 添加窗口大小改变时重新调整图表大小
            window.addEventListener('resize', function() {
                activityChart.resize();
            });
            
            // 添加设备类型过滤变更事件
            document.getElementById('activityDevice').addEventListener('change', function() {
                // 这里可以添加基于设备类型的数据过滤逻辑
                // 模拟数据更新
                const newData = data.map(item => {
                    const [hour, day, val] = item;
                    // 随机调整值，模拟不同设备类型的数据
                    return [hour, day, Math.max(0, val + Math.floor(Math.random() * 10) - 5)];
                });
                
                option.series[0].data = newData;
                activityChart.setOption(option);
            });
            
            // 添加活动类型过滤变更事件
            document.getElementById('activityType').addEventListener('change', function() {
                // 模拟数据更新
                const newData = data.map(item => {
                    const [hour, day, val] = item;
                    // 随机调整值，模拟不同活动类型的数据
                    return [hour, day, Math.max(0, val + Math.floor(Math.random() * 15) - 7)];
                });
                
                option.series[0].data = newData;
                activityChart.setOption(option);
            });
        }
        
        // 设备分布图表初始化
        function initDeviceDistribution() {
            // 初始化ECharts实例
            const distributionChart = echarts.init(document.getElementById('deviceDistribution'));
            
            // 设备类型数据
            const option = {
                tooltip: {
                    trigger: 'item',
                    formatter: '{b}: {c} ({d}%)'
                },
                legend: {
                    orient: 'horizontal',
                    bottom: 10,
                    data: ['摄像头', '传感器', '网关', '控制器', '电源单元']
                },
                series: [
                    {
                        name: '设备分布',
                        type: 'pie',
                        radius: ['40%', '70%'],
                        avoidLabelOverlap: false,
                        itemStyle: {
                            borderRadius: 10,
                            borderColor: '#fff',
                            borderWidth: 2
                        },
                        label: {
                            show: false,
                            position: 'center'
                        },
                        emphasis: {
                            label: {
                                show: true,
                                fontSize: '18',
                                fontWeight: 'bold'
                            }
                        },
                        labelLine: {
                            show: false
                        },
                        data: [
                            { value: 8, name: '摄像头', itemStyle: { color: '#ff6700' } },
                            { value: 12, name: '传感器', itemStyle: { color: '#1890ff' } },
                            { value: 3, name: '网关', itemStyle: { color: '#52c41a' } },
                            { value: 5, name: '控制器', itemStyle: { color: '#faad14' } },
                            { value: 2, name: '电源单元', itemStyle: { color: '#722ed1' } }
                        ]
                    }
                ]
            };
            
            // 应用配置项
            distributionChart.setOption(option);
            
            // 添加窗口大小改变时重新调整图表大小
            window.addEventListener('resize', function() {
                distributionChart.resize();
            });
            
            // 添加视图类型变更事件
            document.getElementById('distributionView').addEventListener('change', function() {
                const viewType = this.value;
                let newOption = {};
                
                if (viewType === 'location') {
                    newOption = {
                        series: [{
                            data: [
                                { value: 10, name: '一楼', itemStyle: { color: '#ff6700' } },
                                { value: 8, name: '二楼', itemStyle: { color: '#1890ff' } },
                                { value: 4, name: '三楼', itemStyle: { color: '#52c41a' } },
                                { value: 6, name: '室外', itemStyle: { color: '#faad14' } },
                                { value: 2, name: '设备室', itemStyle: { color: '#722ed1' } }
                            ]
                        }],
                        legend: {
                            data: ['一楼', '二楼', '三楼', '室外', '设备室']
                        }
                    };
                } else if (viewType === 'status') {
                    newOption = {
                        series: [{
                            data: [
                                { value: 18, name: '在线', itemStyle: { color: '#52c41a' } },
                                { value: 3, name: '离线', itemStyle: { color: '#f5222d' } },
                                { value: 2, name: '警告', itemStyle: { color: '#faad14' } },
                                { value: 1, name: '维护中', itemStyle: { color: '#1890ff' } }
                            ]
                        }],
                        legend: {
                            data: ['在线', '离线', '警告', '维护中']
                        }
                    };
                } else { // type 默认
                    newOption = {
                        series: [{
                            data: [
                                { value: 8, name: '摄像头', itemStyle: { color: '#ff6700' } },
                                { value: 12, name: '传感器', itemStyle: { color: '#1890ff' } },
                                { value: 3, name: '网关', itemStyle: { color: '#52c41a' } },
                                { value: 5, name: '控制器', itemStyle: { color: '#faad14' } },
                                { value: 2, name: '电源单元', itemStyle: { color: '#722ed1' } }
                            ]
                        }],
                        legend: {
                            data: ['摄像头', '传感器', '网关', '控制器', '电源单元']
                        }
                    };
                }
                
                distributionChart.setOption(newOption);
            });
            
            // 导出按钮事件
            document.getElementById('distributionExport').addEventListener('click', function() {
                const dataUrl = distributionChart.getDataURL();
                const link = document.createElement('a');
                link.download = '设备分布-' + new Date().toISOString().slice(0, 10) + '.png';
                link.href = dataUrl;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            });
        }
        
        // 设备地理分布地图初始化
        function initDeviceMap() {
            // 由于需要加载实际地图数据，这里模拟一个简单的地图容器
            const mapContainer = document.getElementById('deviceLocationMap');
            
            // 创建一个简单的HTML内容来表示地图
            mapContainer.innerHTML = `
                <div style="width:100%; height:100%; display:flex; flex-direction:column; justify-content:center; align-items:center; background-color:#f0f0f0;">
                    <div style="font-size:18px; margin-bottom:10px;">设备部署地图</div>
                    <div style="color:#666; font-size:14px; text-align:center;">
                        此处将集成实际地图数据，显示设备部署位置和状态<br>
                        可以连接到实际地图API以获取精确位置信息<br><br>
                        <button class="btn btn-default" onclick="alert('地图数据加载功能将在正式版本实现')">加载地图数据</button>
                    </div>
                </div>
            `;
            
            // 添加地图过滤器变更事件
            document.getElementById('mapShowOptions').addEventListener('change', function() {
                alert('地图过滤视图已更新: ' + this.value);
            });
            
            document.getElementById('mapFloor').addEventListener('change', function() {
                alert('地图楼层视图已更新: ' + this.value);
            });
        }
        
        // 异常检测图表初始化
        function initAnomalyChart() {
            const ctx = document.getElementById('anomalyChart').getContext('2d');
            
            // 清除旧的图表实例
            if (window.anomalyChartInstance) {
                window.anomalyChartInstance.destroy();
            }
            
            // 模拟数据
            const labels = ['4-8', '4-9', '4-10', '4-11', '4-12', '4-13', '4-14'];
            const normalData = [95, 97, 94, 96, 95, 94, 93];
            const anomalyData = [5, 3, 6, 4, 5, 6, 7];
            
            // 创建新图表
            window.anomalyChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: '正常行为',
                            data: normalData,
                            borderColor: '#52c41a',
                            backgroundColor: 'rgba(82, 196, 26, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: true,
                            yAxisID: 'y'
                        },
                        {
                            label: '异常检测',
                            data: anomalyData,
                            borderColor: '#f5222d',
                            backgroundColor: 'rgba(245, 34, 45, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: true,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: '正常行为 (%)'
                            },
                            min: 0,
                            max: 100
                        },
                        y1: {
                            beginAtZero: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: '异常检测 (%)'
                            },
                            min: 0,
                            max: 15,
                            grid: {
                                drawOnChartArea: false
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
            
            // 添加异常检测按钮事件监听器
            document.getElementById('runAnomalyDetection').addEventListener('click', function() {
                // 显示加载状态
                const originalText = this.innerHTML;
                this.innerHTML = `<i class="material-icons">hourglass_top</i> 检测中...`;
                this.disabled = true;
                
                // 模拟异步检测过程
                setTimeout(() => {
                    // 模拟数据更新
                    const newNormalData = normalData.map(val => Math.min(100, Math.max(85, val + Math.floor(Math.random() * 5) - 2)));
                    const newAnomalyData = anomalyData.map(val => Math.min(15, Math.max(1, val + Math.floor(Math.random() * 4) - 2)));
                    
                    window.anomalyChartInstance.data.datasets[0].data = newNormalData;
                    window.anomalyChartInstance.data.datasets[1].data = newAnomalyData;
                    window.anomalyChartInstance.update();
                    
                    // 恢复按钮状态
                    this.innerHTML = originalText;
                    this.disabled = false;
                    
                    alert('异常检测完成! 发现 ' + Math.floor(Math.random() * 3 + 1) + ' 个新异常.');
                }, 1500);
            });
        }
        
        // 模态框控制
        function showDetailModal(metricName) {
            // 设置模态框标题
            document.getElementById('modalTitle').textContent = metricName + ' 详情';
            
            // 为不同的指标加载不同的图表和详情
            const modalBody = document.getElementById('modalDetails');
            
            // 根据指标名称生成不同的内容
            if (metricName === '总设备健康指数') {
                modalBody.innerHTML = `
                    <div class="filter-row">
                        <div class="filter-group">
                            <span class="filter-label">时间范围：</span>
                            <select class="filter-select">
                                <option>最近7天</option>
                                <option>最近30天</option>
                                <option>最近90天</option>
                            </select>
                        </div>
                    </div>
                    <p style="margin: 10px 0;">设备健康指数由以下因素综合评估得出：</p>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li>在线时间率 (权重: 30%)</li>
                        <li>错误率 (权重: 25%)</li>
                        <li>性能指标 (权重: 20%)</li>
                        <li>安全评分 (权重: 15%)</li>
                        <li>固件更新状态 (权重: 10%)</li>
                    </ul>
                    <p>当前评级: <strong style="color:#52c41a">优秀</strong></p>
                    <p>建议操作: 检查后院摄像头异常问题，可能会进一步提升总健康指数</p>
                `;
                
                // 初始化图表
                initModalDetailChart('modalChart', [
                    { label: '上周', data: [88, 89, 91, 90, 89, 90, 92] },
                    { label: '本周', data: [90, 91, 90, 91, 92, 93, 92] }
                ]);
                
            } else if (metricName === '总设备异常率') {
                modalBody.innerHTML = `
                    <div class="filter-row">
                        <div class="filter-group">
                            <span class="filter-label">按设备类型：</span>
                            <select class="filter-select">
                                <option>全部设备</option>
                                <option>摄像头</option>
                                <option>网关</option>
                                <option>传感器</option>
                            </select>
                        </div>
                    </div>
                    <p style="margin: 10px 0;">异常来源分布:</p>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>异常类型</th>
                                <th>占比</th>
                                <th>趋势</th>
                                <th>关联设备</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>连接不稳定</td>
                                <td>42%</td>
                                <td><span class="trend-down">↓</span></td>
                                <td>后院摄像头, 智能照明控制器</td>
                            </tr>
                            <tr>
                                <td>性能波动</td>
                                <td>31%</td>
                                <td><span class="trend-down">↓</span></td>
                                <td>前门摄像头</td>
                            </tr>
                            <tr>
                                <td>数据异常</td>
                                <td>18%</td>
                                <td><span class="trend-up" style="color:var(--danger)">↑</span></td>
                                <td>客厅传感器</td>
                            </tr>
                            <tr>
                                <td>其他</td>
                                <td>9%</td>
                                <td><span class="trend-down">↓</span></td>
                                <td>多种设备</td>
                            </tr>
                        </tbody>
                    </table>
                `;
                
                // 初始化图表
                initModalDetailChart('modalChart', [
                    { 
                        label: '异常率', 
                        data: [4.8, 5.2, 4.7, 4.3, 3.9, 3.5, 3.2], 
                        borderColor: '#f5222d',
                        backgroundColor: 'rgba(245, 34, 45, 0.1)'
                    }
                ]);
                
            } else if (metricName === '安全事件总数') {
                modalBody.innerHTML = `
                    <div class="filter-row">
                        <div class="filter-group">
                            <span class="filter-label">风险级别：</span>
                            <select class="filter-select">
                                <option>全部</option>
                                <option>高</option>
                                <option>中</option>
                                <option>低</option>
                            </select>
                        </div>
                    </div>
                    <p style="margin: 10px 0;">安全事件分类:</p>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>事件类型</th>
                                <th>数量</th>
                                <th>平均处理时间</th>
                                <th>状态</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>未授权访问</td>
                                <td>5</td>
                                <td>1.2小时</td>
                                <td><span class="status status-warning">2个待解决</span></td>
                            </tr>
                            <tr>
                                <td>异常通信</td>
                                <td>4</td>
                                <td>2.5小时</td>
                                <td><span class="status status-info">全部已解决</span></td>
                            </tr>
                            <tr>
                                <td>固件漏洞</td>
                                <td>3</td>
                                <td>5.8小时</td>
                                <td><span class="status status-info">全部已解决</span></td>
                            </tr>
                            <tr>
                                <td>其他安全事件</td>
                                <td>2</td>
                                <td>0.8小时</td>
                                <td><span class="status status-info">全部已解决</span></td>
                            </tr>
                        </tbody>
                    </table>
                `;
                
                // 初始化图表
                initModalDetailChart('modalChart', [
                    { 
                        label: '高风险', 
                        data: [3, 4, 2, 3, 2, 1, 2],
                        type: 'bar',
                        backgroundColor: 'rgba(245, 34, 45, 0.6)'
                    },
                    { 
                        label: '中风险', 
                        data: [8, 7, 9, 8, 6, 5, 4],
                        type: 'bar',
                        backgroundColor: 'rgba(250, 173, 20, 0.6)'
                    },
                    { 
                        label: '低风险', 
                        data: [12, 14, 11, 10, 8, 9, 8],
                        type: 'bar',
                        backgroundColor: 'rgba(82, 196, 26, 0.6)'
                    }
                ], true);
                
            } else if (metricName === '平均响应时间') {
                modalBody.innerHTML = `
                    <div class="filter-row">
                        <div class="filter-group">
                            <span class="filter-label">设备类型：</span>
                            <select class="filter-select">
                                <option>全部</option>
                                <option>摄像头</option>
                                <option>传感器</option>
                                <option>网关</option>
                            </select>
                        </div>
                    </div>
                    <p style="margin: 10px 0;">响应时间分布:</p>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>设备</th>
                                <th>平均响应时间</th>
                                <th>最长响应时间</th>
                                <th>稳定性</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>主网关</td>
                                <td>18ms</td>
                                <td>45ms</td>
                                <td><span class="status status-normal">优秀</span></td>
                            </tr>
                            <tr>
                                <td>前门摄像头</td>
                                <td>42ms</td>
                                <td>120ms</td>
                                <td><span class="status status-normal">良好</span></td>
                            </tr>
                            <tr>
                                <td>客厅传感器</td>
                                <td>12ms</td>
                                <td>28ms</td>
                                <td><span class="status status-normal">优秀</span></td>
                            </tr>
                            <tr>
                                <td>后院摄像头</td>
                                <td>67ms</td>
                                <td>280ms</td>
                                <td><span class="status status-warning">需改进</span></td>
                            </tr>
                        </tbody>
                    </table>
                `;
                
                // 初始化图表
                initModalDetailChart('modalChart', [
                    { 
                        label: '平均响应时间', 
                        data: [205, 210, 202, 215, 225, 218, 218],
                        borderColor: '#1890ff',
                        backgroundColor: 'rgba(24, 144, 255, 0.1)'
                    }
                ]);
            }
            
            // 显示模态框
            document.getElementById('detailModal').style.display = 'block';
        }
        
        // 初始化模态框详情图表
        function initModalDetailChart(canvasId, datasets, isStacked = false) {
            const ctx = document.getElementById(canvasId).getContext('2d');
            
            // 清除旧的图表实例
            if (window.modalChartInstance) {
                window.modalChartInstance.destroy();
            }
            
            // 模拟日期标签
            const labels = ['4-8', '4-9', '4-10', '4-11', '4-12', '4-13', '4-14'];
            
            // 默认图表配置
            const defaultConfig = {
                type: 'line',
                borderWidth: 2,
                fill: true,
                tension: 0.4
            };
            
            // 处理数据集，应用默认配置
            const processedDatasets = datasets.map(dataset => {
                return {
                    ...defaultConfig,
                    ...dataset
                };
            });
            
            // 创建图表
            window.modalChartInstance = new Chart(ctx, {
                type: isStacked ? 'bar' : 'line',
                data: {
                    labels: labels,
                    datasets: processedDatasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            stacked: isStacked
                        },
                        y: {
                            stacked: isStacked,
                            beginAtZero: true
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }
        
        // 关闭模态框
        function closeModal() {
            document.getElementById('detailModal').style.display = 'none';
        }
        
        // 导出模态框数据
        function exportModalData() {
            const title = document.getElementById('modalTitle').textContent.trim();
            alert(`正在导出 ${title} 的数据...`);
            
            // 这里可以添加实际的导出逻辑
            setTimeout(() => {
                alert('数据导出成功!');
            }, 1000);
        }
        
        // 导出数据
        function exportData(format) {
            alert(`正在导出数据为 ${format.toUpperCase()} 格式...`);
            // 隐藏导出选项菜单
            document.getElementById('exportOptions').style.display = 'none';
            
            // 这里可以添加实际的导出逻辑
            setTimeout(() => {
                alert('数据导出成功!');
            }, 1000);
        }
        
        // 当点击页面其他区域时，隐藏导出选项
        document.addEventListener('click', function(event) {
            const exportButton = document.getElementById('exportButton');
            const exportOptions = document.getElementById('exportOptions');
            
            if (!exportButton.contains(event.target) && exportOptions.style.display === 'block') {
                exportOptions.style.display = 'none';
            }
        });

        // 模拟当前时间显示，实际开发中可使用实时更新的系统时间
        document.addEventListener('DOMContentLoaded', function() {
            const currentTime = new Date();
            const formattedDate = `${currentTime.getFullYear()}-${(currentTime.getMonth() + 1).toString().padStart(2, '0')}-${currentTime.getDate().toString().padStart(2, '0')} ${currentTime.getHours().toString().padStart(2, '0')}:${currentTime.getMinutes().toString().padStart(2, '0')}:${currentTime.getSeconds().toString().padStart(2, '0')}`;
            
            // 可以添加到页面上显示当前时间
            if (document.getElementById('current-time')) {
                document.getElementById('current-time').textContent = formattedDate;
            }
        });
    </script>
</body>
</html>